<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Homepage</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.6/dist/css/bootstrap-select.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
        integrity = "sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin = "anonymous" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"
        integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.6/dist/js/bootstrap-select.min.js"></script>

</head>

<body>
    <div class="container">

        <div id="myModal" class="modal"
            style="width:50%; text-align: center; margin-left: 25%; margin-right:25%; margin-top: 5%">

            <!-- Modal content -->
            <div class="modal-content">
                <h1>Your most compatible companion is:</h1>
                <div class="companion"></div>
                <img class="companionImage"
                    src="https://www.akc.org/wp-content/themes/akc/component-library/assets/img/welcome.jpg">


                <span class="close">&times;</span>

            </div>

        </div>

        <h1>Survey Questions</h1>

        <hr>

        <h2 style="font-weight: bold">About You</h2>

        <form>
            <div class="form-group">
                <label for="user-name">Name (required)</label>
                <input type="text" class="form-control" id="user-name">
            </div>
            <div class="form-group">
                <label for="user-image">Link to Photo (required)</label>
                <input type="text" class="form-control" id="user-image">
            </div>
        </form>
        <h3 style="font-weight: bold">Question 1</h3>
        <h4>I love a good party</h4>
        <select id="q1" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 2</h3>
        <h4>I like to keep a tight schedule</h4>
        <select id="q2" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 3</h3>
        <h4>I keep a very clean house</h4>
        <select id="q3" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 4</h3>
        <h4>I am a social butterfly</h4>
        <select id="q4" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 5</h3>
        <h4>I am more logical than emotional</h4>
        <select id="q5" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 6</h3>
        <h4>I love to travel to exotic places</h4>
        <select id="q6" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 7</h3>
        <h4>I am very sensitive</h4>
        <select id="q7" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 8</h3>
        <h4>I am very competitive</h4>
        <select id="q8" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 9</h3>
        <h4>I like a lot of alone time</h4>
        <select id="q9" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>

        <h3 style="font-weight: bold">Question 10</h3>
        <h4>I have many friends</h4>
        <select id="q10" class="selectpicker">
            <option selected>Choose an answer</option>
            <option>1 (Strongly Disagree)</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 (Strongly Agree)</option>
        </select>
        <br><br>
        <button id="submit" type="submit" class="btn btn-primary btn-lg btn-block"><span class="fa fa-check-circle"
                aria-hidden="true"></i>
                Submit</button>

</body>

</html>

<script type="text/javascript">
        $("#submit").on("click", function (event) {
            event.preventDefault();

            var newFriend = {
                name: $("#user-name").val().trim(),
                photo: $("#user-image").val().trim(),
                scores: [
                    parseInt($("#q1").val()),
                    parseInt($("#q2").val()),
                    parseInt($("#q3").val()),
                    parseInt($("#q4").val()),
                    parseInt($("#q5").val()),
                    parseInt($("#q6").val()),
                    parseInt($("#q7").val()),
                    parseInt($("#q8").val()),
                    parseInt($("#q9").val()),
                    parseInt($("#q10").val()),
                ]
            }

            console.log(newFriend);

            $.post("/api/friends", newFriend,
                function (data) {
                    if (data) {
                        alert("Yay");
                    }
                    else {
                        alert("Doh!")
                    }
                }
            )

            $.get("/api/friends", function (data) {
                var differenceArray = [];
                var numberOfFriends = data.length - 1;
                for (i = 0; i < numberOfFriends; i++) {
                    var totalDifference = 0;
                    for (j = 0; j < 10; j++) {
                        totalDifference += Math.abs(data[numberOfFriends].scores[j] - data[i].scores[j]);
                    }
                    console.log(totalDifference);
                    differenceArray.push(totalDifference);
                }
                var closestMatch = Math.min(...differenceArray);
                console.log(closestMatch);
                var position = differenceArray.indexOf(closestMatch)
                console.log(position);
                console.log(data[position]);
                $('.companion').html(data[position].name);
                $('.companionImage').attr("src", data[position].photo);
                $('.modal').fadeIn();
            })

        })
    $('.close').on('click', function () {
        $('.modal').fadeOut();
    });

</script>